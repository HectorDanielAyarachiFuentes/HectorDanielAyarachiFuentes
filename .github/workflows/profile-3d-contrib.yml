name: GitHub-Profile-3D-Contrib

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    name: generate-github-profile-3d-contrib

    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v3

      - name: Instalar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Instalar dependencias necesarias (para renderizado gráfico)
        run: |
          sudo apt-get update
          sudo apt-get install -y libglu1-mesa xvfb unzip curl

      - name: Descargar y descomprimir el generador de contribuciones 3D
        run: |
          curl -L https://github.com/ashutosh1919/github-contribution-3d/archive/refs/heads/main.zip -o gen.zip
          unzip gen.zip
          mv github-contribution-3d-main github-contribution-3d

      - name: Ejecutar el generador y mover el archivo generado
        run: |
          cd github-contribution-3d
          npm install
          USERNAME=${{ github.repository_owner }} GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }} npm start
          mv profile-3d-contrib.svg ../profile-3d-contrib.svg
          cd ..

      - name: Configurar Git y subir la imagen al repositorio
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git add profile-3d-contrib.svg
          git commit -m "Actualizar gráfico 3D de contribuciones" || echo "No hay cambios para commitear."
          git push
